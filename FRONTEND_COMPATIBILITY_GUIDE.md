# ุฏููู ุงูุชูุงูู ูุน ุงูุชุทุจูู (Frontend Compatibility)

## โ ุงูุฎุจุฑ ุงูุณุงุฑ: ูุง ุชุญุชุงุฌ ูุฃู ุชุนุฏููุงุช!

ุงูุชุทุจูู ุงูุญุงูู ูุชูุงูู 100% ูุน ุงูุชุนุฏูู ุงูุฌุฏูุฏ ูู ุงูุจุงู ุฅูุฏ ุจุฏูู ุงูุญุงุฌุฉ ูุฃู ุชุบููุฑุงุช.

---

## ๐ ููู ูุนูู ุงูุชุทุจูู ุญุงููุงูุ

### ุงูุณููุงุฑูู 1: ุงูุฅุนูุงู ููุจูู (Status 200)
```dart
// ุนูุฏูุง ูุฑุฌุน ุงูุจุงู ุฅูุฏ status 200
final ok = await provider.submitListing(...);

if (ok) {  // โ ุงููุฌุงุญ
  // ูุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ
  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text('ุชู ุฅูุดุงุก ุงูุฅุนูุงู'))
  );
  
  // ูุฑุฌุน ููุตูุญุฉ ุงูุณุงุจูุฉ
  context.pop();
}
```

### ุงูุณููุงุฑูู 2: ุงูุฅุนูุงู ูุฑููุถ - ูุญุชุงุฌ ุฏูุน (Status 402)
```dart
if (!ok) {
  final bool isPaymentRequired = 
    (provider.lastErrorCode == 402) ||
    msg.contains('ูุง ุชููู ุจุงูุฉ ูุนูุงูุฉ') ||
    msg.contains('payment_required');
    
  if (isPaymentRequired) {
    // ูุนุฑุถ dialog ูุน ุฎูุงุฑุงุช:
    // 1. ุงุดุชุฑู ูู ุจุงูุฉ
    // 2. ุงุฏูุน ูููุฉ ุงูุฅุนูุงู
    // 3. ุฅูุบุงุก
  }
}
```

---

## ๐ฏ ูุงุฐุง ูุญุฏุซ ูุน ุงูุชุนุฏูู ุงูุฌุฏูุฏุ

### ุญุงูุฉ 1: ุณุนุฑ ุงูุจุงูุฉ = 0 (ุงูุญุงูุฉ ุงูุฌุฏูุฏุฉ)

```
ุงููุณุชุฎุฏู ูุฎุชุงุฑ ุจุงูุฉ standard/featured
        โ
ุงูุจุงู ุฅูุฏ ูุชุญูู ูู ุงูุณุนุฑ
        โ
ุงูุณุนุฑ = 0 ุ
        โ
โ ูุนู โ ููุจู ุงูุฅุนูุงู ูุจุงุดุฑุฉ
        โ
ูุฑุฌุน Status 200 + payment.type = "free_plan"
        โ
ุงูุชุทุจูู ูุณุชูุจู ok = true
        โ
ูุนุฑุถ "ุชู ุฅูุดุงุก ุงูุฅุนูุงู" โ
        โ
ูุฑุฌุน ููุตูุญุฉ ุงูุณุงุจูุฉ
```

**ุงููุชูุฌุฉ:** ุงูุชุทุจูู ูุชุนุงูู ูุนูุง ููุฌุงุญ ุนุงุฏูุ ูุง ูุญุชุงุฌ ุฃู ุชุนุฏูู!

---

### ุญุงูุฉ 2: ุณุนุฑ ุงูุจุงูุฉ > 0 ุจุฏูู ุฑุตูุฏ

```
ุงููุณุชุฎุฏู ูุฎุชุงุฑ ุจุงูุฉ standard/featured
        โ
ุงูุจุงู ุฅูุฏ ูุชุญูู ูู ุงูุณุนุฑ
        โ
ุงูุณุนุฑ > 0 ุ
        โ
โ ูุนู โ ูุชุญูู ูู ุงูุฑุตูุฏ
        โ
ูุง ููุฌุฏ ุฑุตูุฏ ุ
        โ
โ ูุฑูุถ ุงูุฅุนูุงู
        โ
ูุฑุฌุน Status 402 + payment_required = true
        โ
ุงูุชุทุจูู ูุณุชูุจู ok = false
        โ
ูุนุฑุถ dialog ูุน ุฎูุงุฑุงุช ุงูุฏูุน
```

**ุงููุชูุฌุฉ:** ุงูุชุทุจูู ูุชุนุงูู ูุนูุง ููุง ููุ ูุง ูุญุชุงุฌ ุฃู ุชุนุฏูู!

---

## ๐ ุฌุฏูู ููุงุฑูุฉ ุงูู Responses

| ุงูุณููุงุฑูู | Status Code | Response | ุณููู ุงูุชุทุจูู | ุชุนุฏูู ูุทููุจุ |
|-----------|-------------|----------|--------------|--------------|
| ุณุนุฑ = 0 | 200 | `{payment: {type: "free_plan"}}` | ูุนุฑุถ ูุฌุงุญ โ | โ ูุง |
| ุณุนุฑ > 0 + ุฑุตูุฏ | 200 | `{payment: {type: "package"}}` | ูุนุฑุถ ูุฌุงุญ โ | โ ูุง |
| ุณุนุฑ > 0 ุจุฏูู ุฑุตูุฏ | 402 | `{payment_required: true}` | ูุนุฑุถ dialog ุฏูุน | โ ูุง |
| ุฃุฏูู | 200 | `{payment: {type: "admin_bypass"}}` | ูุนุฑุถ ูุฌุงุญ โ | โ ูุง |

---

## ๐ ุชุฏูู ุงูุจูุงูุงุช ุงููุงูู

### ูู ุงูุชุทุจูู (Flutter):
```dart
// 1. ุงููุณุชุฎุฏู ูููุฃ ุงูุจูุงูุงุช ููุฎุชุงุฑ plan_type
final payload = CreateListingPayload(
  title: _adTitle,
  price: _price,
  plan_type: _selectedPlanType,  // 'standard' ุฃู 'featured' ุฃู 'free'
  // ... ุจููุฉ ุงูุจูุงูุงุช
);

// 2. ุฅุฑุณุงู ููุจุงู ุฅูุฏ
final ok = await provider.submitListing(
  categorySlug: widget.categorySlug,
  payload: payload,
  mainImage: mainFile,
  images: thumbFiles,
);

// 3. ูุนุงูุฌุฉ ุงููุชูุฌุฉ
if (ok) {
  // โ ูุฌุญ - ูุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ
  showSnackBar('ุชู ุฅูุดุงุก ุงูุฅุนูุงู');
  context.pop();
} else {
  // โ ูุดู - ูุชุญูู ูู ุงูุณุจุจ
  if (provider.lastErrorCode == 402) {
    // ูุนุฑุถ ุฎูุงุฑุงุช ุงูุฏูุน
    showPaymentDialog();
  } else {
    // ุฎุทุฃ ุขุฎุฑ
    showSnackBar(provider.error);
  }
}
```

### ูู ุงูุจุงู ุฅูุฏ (Laravel):
```php
// 1. ุงุณุชูุจุงู ุงูุจูุงูุงุช
$planType = $request->input('plan_type'); // 'standard' ุฃู 'featured'

// 2. ุงูุชุญูู ูู ุงูุณุนุฑ (ุงูููุฏ ุงูุฌุฏูุฏ)
$planPrice = $planType === 'featured'
    ? $prices->featured_ad_price
    : $prices->standard_ad_price;

if ($planPrice == 0) {
    // โ ุณุนุฑ = 0 โ ูุจูู ูุจุงุดุฑ
    return response()->json([
        'data' => $listing,
        'payment' => [
            'type' => 'free_plan',
            'price' => 0,
        ],
    ], 200);
}

// 3. ุฅุฐุง ุงูุณุนุฑ > 0ุ ูุชุญูู ูู ุงูุฑุตูุฏ
if (!hasBalance) {
    // โ ูุง ููุฌุฏ ุฑุตูุฏ โ ุฑูุถ
    return response()->json([
        'success' => false,
        'payment_required' => true,
        'message' => 'ูุง ุชููู ุจุงูุฉ ูุนูุงูุฉ...',
    ], 402);
}

// 4. ุฅุฐุง ููุฌุฏ ุฑุตูุฏ โ ูุจูู + ุฎุตู
return response()->json([
    'data' => $listing,
    'payment' => [
        'type' => 'package',
        'price' => $planPrice,
    ],
], 200);
```

---

## โ ููุงุฐุง ูุง ุชุญุชุงุฌ ุชุนุฏููุงุชุ

### 1. ุงูุชุทุจูู ูุนุชูุฏ ุนูู Status Code
```dart
// ุงูุชุทุจูู ูุชุญูู ูู ุงููุฌุงุญ/ุงููุดู ุจูุงุกู ุนูู:
if (ok) {  // Status 200 = ูุฌุงุญ
  // ุฃู response ุจู 200 ูุนุชุจุฑ ูุฌุงุญ
}
```

### 2. ุงูุชุทุจูู ูุง ูุชุญูู ูู payment.type
```dart
// ุงูุชุทุจูู ูุง ููุญุต ููุน ุงูุฏูุน ูู ุญุงูุฉ ุงููุฌุงุญ
// ููุท ูุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ ููุฑุฌุน
```

### 3. ุงูุชุทุจูู ูุชุนุงูู ูุน 402 ุจุดูู ุนุงู
```dart
// ุฃู 402 ูุนุฑุถ ุฎูุงุฑุงุช ุงูุฏูุน
// ุณูุงุก ูุงู ุงูุณุจุจ:
// - ูุง ููุฌุฏ ุจุงูุฉ
// - ุฑุตูุฏ ููุชูู
// - ุฃู ุณุจุจ ุขุฎุฑ
```

---

## ๐จ ุชุญุณููุงุช ุงุฎุชูุงุฑูุฉ (ุบูุฑ ูุทููุจุฉ)

ุฅุฐุง ุฃุฑุฏุช ุชุญุณูู ุชุฌุฑุจุฉ ุงููุณุชุฎุฏูุ ููููู ุฅุถุงูุฉ:

### 1. ุนุฑุถ ุฑุณุงูุฉ ูุฎุตุตุฉ ููุจุงูุงุช ุงููุฌุงููุฉ
```dart
if (ok && provider.lastResponse?['payment']?['type'] == 'free_plan') {
  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text('ุชู ุฅูุดุงุก ุงูุฅุนูุงู ูุฌุงูุงู! ๐'))
  );
}
```

### 2. ุนุฑุถ badge "ูุฌุงูู" ุนูู ุงูุจุงูุงุช ุฐุงุช ุงูุณุนุฑ 0
```dart
// ูู ุตูุญุฉ ุงุฎุชูุงุฑ ุงูุจุงูุฉ
if (planPrice == 0) {
  return Badge(
    label: Text('ูุฌุงูู'),
    child: PlanCard(...),
  );
}
```

### 3. ุฅุฎูุงุก ุฎูุงุฑุงุช ุงูุฏูุน ููุจุงูุงุช ุงููุฌุงููุฉ
```dart
// ูู dialog ุงูุฏูุน
if (planPrice == 0) {
  // ูุง ุชุนุฑุถ ุฎูุงุฑุงุช ุงูุฏูุน
  return Text('ูุฐู ุงูุจุงูุฉ ูุฌุงููุฉ');
}
```

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ ุงูุณุนุฑ = 0
```
1. ูู ุงูุฏุงุดุจูุฑุฏุ ุงุฌุนู ุณุนุฑ ุจุงูุฉ standard = 0 ููุณู ูุนูู
2. ูู ุงูุชุทุจููุ ุงุฎุชุฑ ูุฐุง ุงููุณู
3. ุงููุฃ ุจูุงูุงุช ุงูุฅุนูุงู ูุงุฎุชุฑ ุจุงูุฉ standard
4. ุงุถุบุท "ูุดุฑ ุงูุฅุนูุงู"
5. ุงููุชูุฌุฉ ุงููุชููุนุฉ: โ "ุชู ุฅูุดุงุก ุงูุฅุนูุงู" ูุจุงุดุฑุฉ ุจุฏูู ุทูุจ ุฏูุน
```

### 2. ุงุฎุชุจุงุฑ ุงูุณุนุฑ > 0 ุจุฏูู ุฑุตูุฏ
```
1. ูู ุงูุฏุงุดุจูุฑุฏุ ุงุฌุนู ุณุนุฑ ุจุงูุฉ standard = 50
2. ุชุฃูุฏ ุฃู ุงููุณุชุฎุฏู ููุณ ูุฏูู ุจุงูุฉ
3. ูู ุงูุชุทุจููุ ุญุงูู ุฅูุดุงุก ุฅุนูุงู standard
4. ุงููุชูุฌุฉ ุงููุชููุนุฉ: โ dialog ูุทูุจ ุงูุฏูุน ุฃู ุงูุงุดุชุฑุงู
```

### 3. ุงุฎุชุจุงุฑ ุงูุณุนุฑ > 0 ูุน ุฑุตูุฏ
```
1. ูู ุงูุฏุงุดุจูุฑุฏุ ุฃุถู ุจุงูุฉ ูููุณุชุฎุฏู ุจุฑุตูุฏ 5 ุฅุนูุงูุงุช
2. ูู ุงูุชุทุจููุ ุฃูุดุฆ ุฅุนูุงู standard
3. ุงููุชูุฌุฉ ุงููุชููุนุฉ: โ "ุชู ุฅูุดุงุก ุงูุฅุนูุงู" + ุฎุตู ูู ุงูุฑุตูุฏ
```

---

## ๐ ุงูุฎูุงุตุฉ

### โ ูุง ูุนูู ุชููุงุฆูุงู:
- ูุจูู ุงูุฅุนูุงูุงุช ุนูุฏูุง ุงูุณุนุฑ = 0
- ุฑูุถ ุงูุฅุนูุงูุงุช ุนูุฏูุง ุงูุณุนุฑ > 0 ูุจุฏูู ุฑุตูุฏ
- ูุจูู ุงูุฅุนูุงูุงุช ุนูุฏูุง ููุฌุฏ ุฑุตูุฏ
- ุนุฑุถ ุฑุณุงุฆู ุงููุฌุงุญ/ุงููุดู ุงูููุงุณุจุฉ

### โ ูุง ูุง ุชุญุชุงุฌู:
- ุชุนุฏูู ููุฏ ุงูุชุทุจูู
- ุชุญุฏูุซ ุงูู API calls
- ุชุบููุฑ ูุนุงูุฌุฉ ุงูู responses
- ุฅุถุงูุฉ ุดุงุดุงุช ุฌุฏูุฏุฉ

### ๐ฏ ุงููุชูุฌุฉ:
**ุงูุชุทุจูู ุณูุนูู ุจุดูู ุทุจูุนู 100% ูุน ุงูุชุนุฏูู ุงูุฌุฏูุฏ ุจุฏูู ุฃู ุชุบููุฑุงุช!**

---

**ุชุงุฑูุฎ ุงูุชูุซูู:** 2026-02-23  
**ุงูุญุงูุฉ:** โ ูุชูุงูู ุชูุงูุงู - ูุง ุชุญุชุงุฌ ุชุนุฏููุงุช
