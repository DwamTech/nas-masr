# ğŸ“¬ Notification & Chat System - NasMasr

## Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆÙ†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª

---

# ğŸ—ï¸ Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¹Ø§Ù… Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Database Schema Design)

Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„Ù…Ù‡Ø§Ù…ØŒ ÙŠØ¬Ø¨ Ø§Ù„Ø§ØªÙØ§Ù‚ Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ `users_conversations` Ù„ÙŠÙ„Ø¨ÙŠ Ù…ØªØ·Ù„Ø¨Ø§Øª "ØµÙ Ù„ÙƒÙ„ Ø±Ø³Ø§Ù„Ø©" Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø© Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©.

**Ø§Ù„Ù…Ù‚ØªØ±Ø­:** ÙŠÙØ¶Ù„ ÙØµÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª (Ø§Ù„Ø±Ø£Ø³) Ø¹Ù† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ (Ø§Ù„ØªÙØ§ØµÙŠÙ„) Ù„Ù„Ø£Ø¯Ø§Ø¡ØŒ ÙˆÙ„ÙƒÙ† Ù„ØªØ¨Ø³ÙŠØ· Ø§Ù„Ø·Ù„Ø¨ ÙÙŠ Ø¬Ø¯ÙˆÙ„ ÙˆØ§Ø­Ø¯ Ø±Ø¦ÙŠØ³ÙŠ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ¬Ù…ÙŠØ¹ groupingØŒ Ø³Ù†Ø³ØªØ®Ø¯Ù… `conversation_id` (UUID) Ù„Ø±Ø¨Ø· Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¨Ø¹Ø¶Ù‡Ø§.

```php
// migration: create_users_conversations_table.php
Schema::create('users_conversations', function (Blueprint $table) {
    $table->id();
    $table->uuid('conversation_id')->index(); // Ù„Ø±Ø¨Ø· Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¨Ø¹Ø¶Ù‡Ø§ (Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹)
    
    // Ø§Ù„Ù…Ø±Ø³Ù„ (Ù…Ù…ÙƒÙ† ÙŠÙƒÙˆÙ† User Ø£Ùˆ Admin)
    $table->morphs('sender'); 
    
    // Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ (Ù…Ù…ÙƒÙ† ÙŠÙƒÙˆÙ† User Ø£Ùˆ NULL ÙÙŠ Ø­Ø§Ù„Ø© Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ù…Ø©ØŒ Ø£Ùˆ Admin)
    $table->nullableMorphs('receiver'); 
    
    $table->text('message');
    $table->timestamp('read_at')->nullable();
    
    // Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù„ØªØ³Ù‡ÙŠÙ„ Ø§Ù„ÙÙ„ØªØ±Ø©
    // 'peer' (Ø¨ÙŠÙ† Ø¹Ù…Ù„Ø§Ø¡), 'support' (Ø¨ÙŠÙ† Ø¹Ù…ÙŠÙ„ ÙˆØ¥Ø¯Ø§Ø±Ø©), 'broadcast' (Ø±Ø³Ø§Ù„Ø© Ø¹Ø§Ù…Ø©)
    $table->string('type')->default('peer')->index(); 
    
    $table->timestamps();
    $table->softDeletes(); // Ù„Ù„Ø£Ø±Ø´ÙØ© ÙˆØ§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
    
    // Indexes for performance
    $table->index(['sender_id', 'sender_type']);
    $table->index(['receiver_id', 'receiver_type']);
});
```

---

# ğŸ“Š Flow Diagrams - Ø±Ø³ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø±

## ğŸ—„ï¸ Database Layer (Ø·Ø¨Ù‚Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    users_conversations                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ conversation_id â”‚ sender     â”‚ receiver    â”‚ message  â”‚  â”‚
â”‚  â”‚ (UUID)          â”‚ (morph)    â”‚ (morph)     â”‚ type     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼             â–¼             â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  User  â”‚   â”‚ Admin  â”‚   â”‚ System â”‚
         â”‚ Model  â”‚   â”‚ Model  â”‚   â”‚(Support)â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## âš™ï¸ Service Layer (Ø·Ø¨Ù‚Ø© Ø§Ù„Ø®Ø¯Ù…Ø§Øª)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚    ChatService      â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ â€¢ getConversationId()â”‚
                    â”‚ â€¢ sendMessage()      â”‚
                    â”‚ â€¢ getHistory()       â”‚
                    â”‚ â€¢ getInbox()         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                     â–¼                     â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  peer   â”‚          â”‚ support â”‚          â”‚broadcastâ”‚
   â”‚ (U â†” U) â”‚          â”‚ (U â†” A) â”‚          â”‚ (A â†’ All)â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”Œ API Endpoints Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ğŸ‘¤ User-to-User        â”‚      â”‚     ğŸ‘” Admin Support       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                            â”‚      â”‚                            â”‚
â”‚ POST /api/chat/send        â”‚      â”‚ GET /admin/support/inbox   â”‚
â”‚         â”‚                  â”‚      â”‚         â”‚                  â”‚
â”‚         â–¼                  â”‚      â”‚         â–¼                  â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚      â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚   â”‚ChatServiceâ”‚â”€â”€â”€â”€â–º DB    â”‚      â”‚   â”‚ All Support Chatsâ”‚     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚      â”‚   â”‚ (Unified View)   â”‚     â”‚
â”‚         â”‚                  â”‚      â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚         â–¼                  â”‚      â”‚                            â”‚
â”‚   MessageSent Event        â”‚      â”‚ POST /admin/support/reply  â”‚
â”‚                            â”‚      â”‚         â”‚                  â”‚
â”‚ GET /api/chat/{userId}     â”‚      â”‚         â–¼                  â”‚
â”‚         â”‚                  â”‚      â”‚   Reply as "Support"       â”‚
â”‚         â–¼                  â”‚      â”‚   (sender = Admin)         â”‚
â”‚   Conversation History     â”‚      â”‚                            â”‚
â”‚                            â”‚      â”‚                            â”‚
â”‚ GET /api/chat/inbox        â”‚      â”‚ GET /admin/monitoring      â”‚
â”‚         â”‚                  â”‚      â”‚         â”‚                  â”‚
â”‚         â–¼                  â”‚      â”‚         â–¼                  â”‚
â”‚   All Conversations        â”‚      â”‚   All Peer Chats           â”‚
â”‚                            â”‚      â”‚   (Read-Only)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¡ Real-time Layer (Ø§Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Laravel Reverb    â”‚
                    â”‚    (WebSocket)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   MessageSent Event â”‚
                    â”‚  ShouldBroadcastNow â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â–¼                                       â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User Private      â”‚               â”‚ Admin Support     â”‚
   â”‚ Channel           â”‚               â”‚ Channel           â”‚
   â”‚ App.User.{id}     â”‚               â”‚ App.Admin.Support â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ÙƒØ§Ù…Ù„ (Complete Flow)

```
User A â”€â”€â”€â”€â–º POST /api/chat/send â”€â”€â”€â”€â–º ChatService
                                            â”‚
                                   getConversationId(A, B)
                                            â”‚
                                   Store in DB (type: peer)
                                            â”‚
                                   Trigger MessageSent Event
                                            â”‚
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â–¼                         â–¼
                         Laravel Reverb           Notification
                               â”‚                   (Optional)
                               â–¼
                         User B receives
                         real-time message
```

---

# ğŸ“‹ Ø®Ø·Ø© Ø§Ù„Ø¹Ù…Ù„ (Execution Tasks)

## ğŸŸ¢ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø§Ù„ØªØ£Ø³ÙŠØ³ ÙˆØ§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© (Infrastructure & Models)

### Task 1.1: Ø¥Ù†Ø´Ø§Ø¡ Migration Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
- [ ] `php artisan make:migration create_users_conversations_table`
- [ ] Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø­Ø³Ø¨ Ø§Ù„Ù€ Schema Ø£Ø¹Ù„Ø§Ù‡

### Task 1.2: Ø¥Ù†Ø´Ø§Ø¡ Model Ù„Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
- [ ] `php artisan make:model UserConversation`
- [ ] Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù‚Ø© `morphTo` Ø¨Ø§Ø³Ù… `sender` Ùˆ `receiver`
- [ ] ØªÙØ¹ÙŠÙ„ `SoftDeletes`

### Task 1.3: ØªØ­Ø¯ÙŠØ« User Model
- [ ] Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù‚Ø© `morphMany` Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø±Ø³Ù„Ø©
- [ ] Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù‚Ø© `morphMany` Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø³ØªÙ„Ù…Ø©

### Task 1.4: Ø¥Ù†Ø´Ø§Ø¡ ChatService
- [ ] Ø¥Ù†Ø´Ø§Ø¡ `app/Services/ChatService.php`
- [ ] Ù…ÙŠØ«ÙˆØ¯ `getConversationId($partyA, $partyB, $type)`
- [ ] Ù…ÙŠØ«ÙˆØ¯ `sendMessage($sender, $receiver, $message, $type)`
- [ ] Ù…ÙŠØ«ÙˆØ¯ `getHistory($conversationId)`
- [ ] Ù…ÙŠØ«ÙˆØ¯ `getInbox($user)`

---

## ğŸŸ¡ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 2: Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (User-to-User)

### Task 2.1: Ø¥Ù†Ø´Ø§Ø¡ ChatController
- [ ] `php artisan make:controller Api/ChatController`
- [ ] Endpoint: `POST /api/chat/send`
- [ ] Endpoint: `GET /api/chat/{userId}`
- [ ] Endpoint: `GET /api/chat/inbox`

### Task 2.2: Ø¥Ù†Ø´Ø§Ø¡ Form Requests
- [ ] `php artisan make:request Chat/SendMessageRequest`
- [ ] Validation: Ø§Ù„ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„ Ù…ÙˆØ¬ÙˆØ¯

### Task 2.3: Ø¥Ø¶Ø§ÙØ© Routes
- [ ] Ø¥Ø¶Ø§ÙØ© chat routes ÙÙŠ `routes/api.php`

---

## ğŸŸ  Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3: Ù†Ø¸Ø§Ù… Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…ÙˆØ­Ø¯ (Unified Admin Support)

### Task 3.1: Ø¥Ù†Ø´Ø§Ø¡ AdminChatController
- [ ] `php artisan make:controller Admin/ChatController`
- [ ] Endpoint: `GET /api/admin/support/inbox`
- [ ] Endpoint: `POST /api/admin/support/reply`

### Task 3.2: ØªØ·Ø¨ÙŠÙ‚ Unified View Logic
- [ ] Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©: `type = 'support'`
- [ ] Ø§Ù„Ù€ `receiver` ÙŠÙƒÙˆÙ† `null` Ø£Ùˆ System ID
- [ ] Ø£ÙŠ Ø£Ø¯Ù…Ù† ÙŠØ±Ù‰ Ù†ÙØ³ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª (Shared Inbox)

---

## ğŸ”´ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 4: Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø£Ø®Ù„Ø§Ù‚ÙŠØ© (Ethical Monitoring)

### Task 4.1: Ø¥Ù†Ø´Ø§Ø¡ MonitoringController
- [ ] `php artisan make:controller Admin/MonitoringController`
- [ ] Endpoint: `GET /api/admin/monitoring/conversations` (Read-Only)
- [ ] Query: Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø­ÙŠØ« `type = 'peer'`

### Task 4.2: Ø¥Ù†Ø´Ø§Ø¡ Middleware Ù„Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
- [ ] `php artisan make:middleware CanMonitorChat`
- [ ] Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© `can:monitor_chat`
- [ ] ØªØ³Ø¬ÙŠÙ„ Log Ù„Ù…Ù† ÙØªØ­ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©

---

## ğŸŸ£ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 5: Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© (Broadcasting)

### Task 5.1: Ø¥Ù†Ø´Ø§Ø¡ SendBulkMessage Job
- [ ] `php artisan make:job SendBulkMessageJob`
- [ ] ÙŠØ³ØªÙ‚Ø¨Ù„ Ù…ØµÙÙˆÙØ© User IDs ÙˆÙ†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
- [ ] Batch Insert Ù„Ù„Ø£Ø¯Ø§Ø¡

### Task 5.2: Ø¥Ø¶Ø§ÙØ© Admin Endpoint
- [ ] Endpoint: `POST /api/admin/broadcast`
- [ ] Dispatch the Job to Queue

---

## ğŸ”µ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 6: Real-time (Laravel Reverb)

### Task 6.1: ØªØ«Ø¨ÙŠØª Laravel Reverb
- [ ] `composer require laravel/reverb`
- [ ] `php artisan reverb:install`
- [ ] Ø¥Ø¹Ø¯Ø§Ø¯ `.env` Ù„Ù„Ù€ WebSocket

### Task 6.2: Ø¥Ù†Ø´Ø§Ø¡ MessageSent Event
- [ ] `php artisan make:event MessageSent`
- [ ] ØªØ·Ø¨ÙŠÙ‚ `ShouldBroadcastNow`

### Task 6.3: Ø¥Ø¹Ø¯Ø§Ø¯ Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¨Ø«
- [ ] Ù‚Ù†Ø§Ø© Ø®Ø§ØµØ©: `App.Models.User.{id}`
- [ ] Ù‚Ù†Ø§Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©: `App.Models.Admin.Support`

---

# ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØªÙ‚Ù†ÙŠØ© Ù…Ù‡Ù…Ø© (Technical Notes)

### ğŸ—ƒï¸ Database Indexing
- Compound Index Ø¹Ù„Ù‰ `(conversation_id, created_at)` Ù„ØªØ³Ø±ÙŠØ¹ Ø¬Ù„Ø¨ Ø§Ù„Ù‡ÙŠØ³ØªÙˆØ±ÙŠ

### ğŸ”’ Security
- **User-to-User:** Gate/Policy ØªÙ…Ù†Ø¹ User A Ù…Ù† Ù‚Ø±Ø§Ø¡Ø© Ù…Ø­Ø§Ø¯Ø«Ø© Ø¨ÙŠÙ† B Ùˆ C
- **Monitoring:** ØªØ³Ø¬ÙŠÙ„ Log Ù„Ù…Ù† ÙØªØ­ Ø£ÙŠ Ù…Ø­Ø§Ø¯Ø«Ø© (Admin Activity Log)

### âš¡ Caching
- Ù„Ø§ ØªØ®Ø²ÙŠÙ† Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Cache
- ØªØ®Ø²ÙŠÙ† "Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ ØºÙŠØ± Ø§Ù„Ù…Ù‚Ø±ÙˆØ¡Ø©" (Unread Count) ÙÙŠ Redis

### ğŸ“¦ Queue
- Ø§Ø³ØªØ®Ø¯Ø§Ù… Queue Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ© Ù„ØªØ¬Ù†Ø¨ Timeout

---

### TODO
- [ ] Task 1.1: Ø¥Ù†Ø´Ø§Ø¡ Migration
- [ ] Task 1.2: Ø¥Ù†Ø´Ø§Ø¡ Model
- [ ] Task 1.3: ØªØ­Ø¯ÙŠØ« User Model
- [ ] Task 1.4: Ø¥Ù†Ø´Ø§Ø¡ ChatService
- [ ] Task 2.1: Ø¥Ù†Ø´Ø§Ø¡ ChatController
- [ ] Task 2.2: Ø¥Ù†Ø´Ø§Ø¡ Form Requests
- [ ] Task 2.3: Ø¥Ø¶Ø§ÙØ© Routes
- [ ] Task 3.1: Ø¥Ù†Ø´Ø§Ø¡ AdminChatController
- [ ] Task 4.1: Ø¥Ù†Ø´Ø§Ø¡ MonitoringController
- [ ] Task 5.1: Ø¥Ù†Ø´Ø§Ø¡ Job Ù„Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¬Ù…Ø§Ø¹ÙŠØ©
- [ ] Task 6.1: ØªØ«Ø¨ÙŠØª Laravel Reverb
- [ ] Task 6.2: Ø¥Ù†Ø´Ø§Ø¡ MessageSent Event

---

*Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: 2025-12-07*
