# ุฏููู ุชูููุฐ ูุงุฌูุงุช ุงููุญุงุฏุซุฉ ูุงูุฅุดุนุงุฑุงุช (Frontend Guide)

ูุฐุง ุงูุฏููู ููุฌู ููุทูุฑู ุงููุงุฌูุงุช (Mobile/Web) ูุชูุถูุญ ููููุฉ ุงูุชุนุงูู ูุน ูุธุงู ุงููุญุงุฏุซุฉ ุงูุฌุฏูุฏุ ุนุฑุถ ููุฎุตุงุช ุงูุฅุนูุงูุงุชุ ุฅุฏุงุฑุฉ ุญุงูุงุช ุงูุชุญููู ูุงูุฃุฎุทุงุกุ ูุชุฌุฑุจุฉ ุงููุณุชุฎุฏู (UX).

---

## ๐ฑ 1. ุดุงุดุฉ ุงููุญุงุฏุซุฉ (Chat Screen)

### ุฃ. ุงูุชุญููู ุงูุฃููู (Initial State)
*   **ุนูุฏ ูุชุญ ุงูุดุงุดุฉ:** ูุฌุจ ุฅุธูุงุฑ **Skeleton Loader** (ุฃุดุจุงู ูุตูุต ูุตูุฑ) ุจุฏูุงู ูู `CircularProgressIndicator` ููุนุทู ุงูุทุจุงุนุงู ุฃุณุฑุน.
*   **API:** `GET /api/chat/{user_id}`

### ุจ. ุนุฑุถ ุงูุฑุณุงุฆู (Rendering Messages)
ูุฌุจ ุงูุชุนุงูู ูุน ููุน ุงูุฑุณุงูุฉ (`content_type`) ูุชุญุฏูุฏ ุดูู ุงูุนุฑุถ:

**1. ุงูููุน ุงููุตู (`text`):**
*   ูุนุฑุถ ูููุงุนุฉ ูุญุงุฏุซุฉ (Bubble) ุนุงุฏูุฉ.
*   ูููู (ูููุฑุณู) ููุณุงุฑ (ูููุณุชูุจู).

**2. ููุน ุงุณุชูุณุงุฑ ุฅุนูุงู (`listing_inquiry`):**
*   **ุงูุดูู:** ูุนุฑุถ ูู **Card** ุฃููู ุฏุงุฎู ููุงุนุฉ ุงููุญุงุฏุซุฉ.
*   **ุงููุญุชูู:**
    *   ุตูุฑุฉ ุงูุฅุนูุงู ุงููุตุบุฑุฉ (`main_image` ูู ูุงุฆู `listing`).
    *   ุนููุงู ุงูุฅุนูุงู (`title`).
    *   ุงูุณุนุฑ (`price`).
    *   ุฒุฑ ุตุบูุฑ "ุนุฑุถ ุงูุฅุนูุงู" ูููู ูุตูุญุฉ ุงูุชูุงุตูู.
*   **ุงูุจูุงูุงุช:** ุณุชุฃุชู ุงูุจูุงูุงุช ุฌุงูุฒุฉ ุฏุงุฎู ูุงุฆู `listing` ุงููุฑูู ูุน ุงูุฑุณุงูุฉ ูู ุงูู API Responseุ ููุง ุฏุงุนู ูุทูุจ endpoint ุฅุถุงูู ููู ุฑุณุงูุฉ.

### ุฌ. ุฅุฑุณุงู ุงูุฑุณุงุฆู (Sending Messages & UX)

**1. Optimistic UI (ุงูุชุญุฏูุซ ุงูุชูุงุคูู):**
*   ุจูุฌุฑุฏ ุถุบุท "ุฅุฑุณุงู"ุ ูู ุจุฅุถุงูุฉ ุงูุฑุณุงูุฉ **ููุฑุงู** ูููุงุฆูุฉ ูุญููุงู ุจููู ุจุงูุช ููููุงู (Opacity 0.7) ุฃู ุฃู ูุคุดุฑ "ุฌุงุฑู ุงูุฅุฑุณุงู".
*   ูุง ุชูุชุธุฑ ุงุณุชุฌุงุจุฉ ุงูู Server ูุฅุธูุงุฑ ุงูุฑุณุงูุฉ.

**2. ุงูุชุนุงูู ูุน ุงููุดู (Error Handling):**
*   ูู ุญุงู ูุดู ุงูู API Request (ูุซูุงู ุงููุทุงุน ูุช):
    *   ุชุญููู ุญุงูุฉ ุงูุฑุณุงูุฉ ุฅูู "ูุดู ุงูุฅุฑุณุงู".
    *   ุฅุธูุงุฑ ุฃููููุฉ **ุนูุงูุฉ ุชุนุฌุจ ุญูุฑุงุก โ** ุจุฌุงูุจ ุงูุฑุณุงูุฉ.
    *   **Action:** ุนูุฏ ุงูุถุบุท ุนูู ุงูุฑุณุงูุฉ ุงููุงุดูุฉุ ุชุธูุฑ ูุงุฆูุฉ: "ุฅุนุงุฏุฉ ุงููุญุงููุฉ (Retry)" ุฃู "ุญุฐู".

**3. ุฅุฑุณุงู ุงุณุชูุณุงุฑ ุนู ุฅุนูุงู (Listing Context):**
*   ุนูุฏ ุฏุฎูู ุงูุดุงุช ูู ุฒุฑ "ุชูุงุตู" ูู ุตูุญุฉ ุฅุนูุงู:
    *   ูุฌุจ ุนุฑุถ "ูุงุฑุช ูุนุงููุฉ" ููู ุตูุฏูู ุงููุชุงุจุฉ (Input Area) ููุถุญ ูููุณุชุฎุฏู ุฃูู ุณูุณุฃู ุนู ูุฐุง ุงูุฅุนูุงู.
    *   ุนูุฏ ุงูุฅุฑุณุงูุ ูุชู ุชุถููู `listing_id` ู `content_type: 'listing_inquiry'` ูู ุงูู Body.

### ุฏ. ูุคุดุฑุงุช ุงููุชุงุจุฉ ูุงููุฑุงุกุฉ
*   ุงุณุชุฎุฏุงู `MessageSent` Event (Pusher/Reverb) ูุชุญุฏูุซ ุงูุดุงุช ูุญุธูุงู.
*   ุชุญุฏูุซ ุญุงูุฉ `read_at` ุนูุฏ ูุชุญ ุงูุดุงุดุฉ (`markAsRead`).

---

## ๐ 2. ุดุงุดุฉ ุงูุฅุดุนุงุฑุงุช (Notifications Screen)

### ุฃ. ุงูุชุตููู (List Item Structure)
ูู ุฅุดุนุงุฑ ูุฌุจ ุฃู ูุญุชูู ุนูู:
*   **ุฃููููุฉ:** ุชุนุจุฑ ุนู ููุน ุงูุฅุดุนุงุฑ (ูุญุงุฏุซุฉุ ุฅุนูุงูุ ูุธุงู).
*   **ุงูุนููุงู:** (ูุซูุงู: "ุฑุณุงูุฉ ุฌุฏูุฏุฉ ูู ุฃุญูุฏ").
*   **ุงูููุช:** (ููุฐ 5 ุฏูุงุฆู).
*   **ุงูุญุงูุฉ:** ุชูููุฒ ุจุตุฑู ููุฅุดุนุงุฑุงุช "ุบูุฑ ุงูููุฑูุกุฉ" (ุฎูููุฉ ููููุฉ ุฎูููุฉ ุฃู ููุทุฉ ุฒุฑูุงุก).

### ุจ. ุงูุชูุงุนู (Interaction)
*   ุนูุฏ ุงูุถุบุท ุนูู ุงูุฅุดุนุงุฑ:
    1.  ุงุณุชุฏุนุงุก `PATCH /api/notifications/{id}/read` (ูู ุงูุฎูููุฉ).
    2.  ุงูุชูุฌูู ููุฑุงู ููุตูุญุฉ ุงููุนููุฉ (ุดุงุดุฉ ุงูุดุงุชุ ุชูุงุตูู ุงูุฅุนูุงูุ ุฅูุฎ) ุจูุงุกู ุนูู `data.type`.

---

## ๐๏ธ ุชูุงุตูู ุชูููุฉ ูุณููุงุฑูููุงุช ุงููุดู

### 1. ูุดู ุชุญููู ุงููุญุงุฏุซุฉ (Get History Failed)
*   ุนุฑุถ ุดุงุดุฉ "ุฎุทุฃ ูู ุงูุงุชุตุงู" ูุน ุฒุฑ ูุงุถุญ **"ุฅุนุงุฏุฉ ุงููุญุงููุฉ"**.
*   ูุง ุชุชุฑู ุงูุดุงุดุฉ ูุงุฑุบุฉ.

### 2. ุงูู Reconnection
*   ูู ุญุงู ุงุณุชุฎุฏุงู `Reverb/Pusher`: ูุฌุจ ุงูุงุณุชูุงุน ูุญุฏุซ `ConnectionState`ุ ูุนูุฏ ุนูุฏุฉ ุงูุงุชุตุงูุ ูุชู ุนูู `Refresh` ุตุงูุช ูุขุฎุฑ ุงูุฑุณุงุฆู ููุชุฃูุฏ ูู ุนุฏู ุถูุงุน ุฃู ุฑุณุงูุฉ ุฃุซูุงุก ุงููุทุงุน ุงูุงุชุตุงู.

### 3. Pagination
*   ูุชู ุชุญููู ุฃูู 50 ุฑุณุงูุฉ.
*   ุนูุฏ ุงูุณุญุจ ููุฃุนูู (Scroll Up)ุ ูุชู ุทูุจ ุงูุตูุญุฉ ุงูุชุงููุฉ (`page=2`) ูุฅุถุงูุฉ ุงูุฑุณุงุฆู ุงููุฏููุฉ ูููุงุฆูุฉ ุงูุญุงููุฉ (Prepend).
*   **ูุคุดุฑ ุชุญููู ุนููู:** ูุธูุฑ ููุท ุนูุฏ ุทูุจ ุงูุฑุณุงุฆู ุงููุฏููุฉ.

---

## ๐ฅ ููุฎุต Endpoints ูููุทูุฑ

| ุงููุธููุฉ | ุงูุทุฑููุฉ | ุงูุฑุงุจุท | ููุงุญุธุงุช |
| :--- | :--- | :--- | :--- |
| ุฌูุจ ุงููุญุงุฏุซุฉ | `GET` | `/api/chat/{user_id}` | ูุฃุชู ูุนู ูุงุฆู `listing` ุฅู ูุฌุฏ |
| ุฅุฑุณุงู ุฑุณุงูุฉ | `POST` | `/api/chat/send` | ููุจู `listing_id`, `content_type` |
| ูุฑุงุกุฉ ุงูุฅุดุนุงุฑุงุช | `PATCH` | `/api/notifications/{id}/read` | |
