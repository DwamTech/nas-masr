# ููุฎุต ุชูููุฐ ููุทู ุงูุจุงูุงุช ุงููุฌุงููุฉ (Free Plan Logic)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ููุทู ุฌุฏูุฏ ููุจูู ุงูุฅุนูุงูุงุช ุงููุฏููุนุฉ (standard/featured) ุจุดูู ูุฌุงูู ุนูุฏูุง ูููู ุณุนุฑ ุงูุจุงูุฉ = 0 ูู ุงููุณู ุงููุญุฏุฏุ ุจุฏูู ุงูุญุงุฌุฉ ูุฑุตูุฏ ุฃู ุจุงูุฉ ุฃู ุตูุงุญูุงุช ุฃุฏูู.

---

## ๐ฏ ุงููุชุทูุจ ุงูุฃุณุงุณู

> "ูู ุณุนุฑ ุงูุจุงูุฉ ูุณุงูู 0ุ ูุชู ูุจูู ุงูุฅุนูุงู ุญุชู ูู ุงูุญุณุงุจ ูุด ุฃุฏูู ููุง ุนูุฏู ุฑุตูุฏ ุณุงุจู ููุง ุฃู ุดูุก"

---

## โ ุงูุชุนุฏููุงุช ุงููููุฐุฉ

### 1. ุชุนุฏูู Controller ุงูุฑุฆูุณู
**ุงูููู:** `app/Http/Controllers/ListingController.php`

**ุงูุชุนุฏูู:**
- ุฅุถุงูุฉ ูุญุต ุฌุฏูุฏ ูู ุจุฏุงูุฉ ููุทู ุงูุจุงูุงุช ุงููุฏููุนุฉ
- ุงูุชุญูู ูู ุณุนุฑ ุงูุจุงูุฉ ูุจู ุฃู ูุญูุตุงุช ุฃุฎุฑู
- ุฅุฐุง ูุงู ุงูุณุนุฑ = 0ุ ูุชู ูุจูู ุงูุฅุนูุงู ูุจุงุดุฑุฉ

**ุงูููุฏ ุงููุถุงู:**
```php
// Check if plan price is 0 (free plan in this category)
$prices = CategoryPlanPrice::where('category_id', $sec->id())->first();
$planPrice = $planNorm === 'featured'
    ? (float) ($prices?->featured_ad_price ?? 0)
    : (float) ($prices?->standard_ad_price ?? 0);

// 0. If plan price is 0, accept ad without any checks
if ($planPrice == 0) {
    $days = $planNorm === 'featured'
        ? ((int)($prices?->featured_days ?? 30))
        : ((int)($prices?->standard_days ?? 30));

    $data['expire_at'] = now()->addDays($days > 0 ? $days : 30);
    $paymentType = 'free_plan';
    $priceOut = 0.0;
    $data['publish_via'] = 'free_plan';
}
```

### 2. ุฅุถุงูุฉ HasFactory Trait
**ุงูููู:** `app/Models/Category.php`

**ุงูุชุนุฏูู:**
- ุฅุถุงูุฉ `use HasFactory;` ูุฏุนู ุงูู factories ูู ุงูุงุฎุชุจุงุฑุงุช

### 3. ุฅูุดุงุก Category Factory
**ุงูููู:** `database/factories/CategoryFactory.php`

**ุงูุบุฑุถ:**
- ุชุณููู ุฅูุดุงุก categories ูู ุงูุงุฎุชุจุงุฑุงุช

### 4. ุฅูุดุงุก ุงุฎุชุจุงุฑุงุช ุดุงููุฉ
**ุงูููู:** `tests/Feature/ListingCreationWithFreePlanTest.php`

**ุงูุงุฎุชุจุงุฑุงุช:**
1. โ ูุจูู ุงูุฅุนูุงู ุนูุฏูุง ุณุนุฑ ุงูุจุงูุฉ = 0
2. โ ูุจูู ุงูุฅุนูุงู ุงููููุฒ ุนูุฏูุง ุณุนุฑู = 0
3. โ ุทูุจ ุงูุฏูุน ุนูุฏูุง ุงูุณุนุฑ > 0 ูุจุฏูู ุจุงูุฉ
4. โ ูุจูู ุงูุฅุนูุงู ุนูุฏูุง ุงููุณุชุฎุฏู ูุฏูู ุฑุตูุฏ
5. โ ุทูุจ ุงูุฏูุน ุนูุฏูุง ุฑุตูุฏ ุงูุจุงูุฉ = 0
6. โ ุงูุฃุฏูู ููููู ุฅูุดุงุก ุฅุนูุงูุงุช ุจุฏูู ูููุฏ

---

## ๐ ุชุฑุชูุจ ุงูุฃููููุงุช ุงูุฌุฏูุฏ

```
ุนูุฏ ุฅูุดุงุก ุฅุนูุงู ูุฏููุน (standard ุฃู featured):

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 0. ูู ุณุนุฑ ุงูุจุงูุฉ = 0ุ              โ
โ    โ ูุนู โ ูุจูู ูุจุงุดุฑ (free_plan)  โ
โ    โ ูุง โ ุงูุชูู ููุฎุทูุฉ ุงูุชุงููุฉ     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1. ูู ูุฏู ุงููุณุชุฎุฏู ุจุงูุฉ ุจุฑุตูุฏุ     โ
โ    โ ูุนู โ ุฎุตู ููุจูู (package)     โ
โ    โ ูุง โ ุงูุชูู ููุฎุทูุฉ ุงูุชุงููุฉ     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 2. ูู ูุฏู ุงููุณุชุฎุฏู ุงุดุชุฑุงู ูุฏููุ    โ
โ    โ ูุนู โ ูุจูู (subscription)     โ
โ    โ ูุง โ ุงูุชูู ููุฎุทูุฉ ุงูุชุงููุฉ     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 3. ูู ุงููุณุชุฎุฏู ุฃุฏููุ               โ
โ    โ ูุนู โ ูุจูู (admin_bypass)     โ
โ    โ ูุง โ ุทูุจ ุงูุฏูุน ุงููุฑุฏู         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ููุงุฑูุฉ ูุจู ูุจุนุฏ

| ุงูุญุงูุฉ | ูุจู ุงูุชุนุฏูู | ุจุนุฏ ุงูุชุนุฏูู |
|--------|-------------|-------------|
| ุณุนุฑ = 0ุ ุจุฏูู ุฑุตูุฏ | โ ุฑูุถ | โ ูุจูู |
| ุณุนุฑ = 0ุ ูุน ุฑุตูุฏ | โ ูุจูู + ุฎุตู | โ ูุจูู ุจุฏูู ุฎุตู |
| ุณุนุฑ > 0ุ ุจุฏูู ุฑุตูุฏ | โ ุฑูุถ | โ ุฑูุถ |
| ุณุนุฑ > 0ุ ูุน ุฑุตูุฏ | โ ูุจูู + ุฎุตู | โ ูุจูู + ุฎุตู |

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ุขูู:
```bash
# Windows
run_free_plan_tests.bat

# Linux/Mac
./run_free_plan_tests.sh

# ุฃู ูุจุงุดุฑุฉ
php artisan test --filter=ListingCreationWithFreePlanTest
```

### ุงุฎุชุจุงุฑ ูุฏูู:
ุฑุงุฌุน ููู `QUICK_TEST_GUIDE.md` ููุชูุงุตูู ุงููุงููุฉ

---

## ๐ ุงููููุงุช ุงููุนุฏูุฉ/ุงููุถุงูุฉ

### ูููุงุช ูุนุฏูุฉ:
1. โ๏ธ `app/Http/Controllers/ListingController.php`
2. โ๏ธ `app/Models/Category.php`

### ูููุงุช ุฌุฏูุฏุฉ:
1. โ `database/factories/CategoryFactory.php`
2. โ `tests/Feature/ListingCreationWithFreePlanTest.php`
3. โ `run_free_plan_tests.bat`
4. โ `run_free_plan_tests.sh`
5. โ `FREE_PLAN_TESTS_README.md`
6. โ `QUICK_TEST_GUIDE.md`
7. โ `FREE_PLAN_IMPLEMENTATION_SUMMARY.md` (ูุฐุง ุงูููู)

---

## ๐จ ุฃูุซูุฉ ุนูู ุงูุงุณุชุฎุฏุงู

### ูุซุงู 1: ูุณู ูุฌุงูู ุชูุงูุงู
```sql
-- ุฌุนู ุฌููุน ุงูุฅุนูุงูุงุช ูู ูุณู "ุงููุธุงุฆู" ูุฌุงููุฉ
UPDATE category_plan_prices 
SET standard_ad_price = 0,
    featured_ad_price = 0
WHERE category_id = (SELECT id FROM categories WHERE slug = 'jobs');
```

**ุงููุชูุฌุฉ:** ุฃู ูุณุชุฎุฏู ููููู ูุดุฑ ุฅุนูุงูุงุช standard ุฃู featured ูู ูุณู ุงููุธุงุฆู ูุฌุงูุงู

### ูุซุงู 2: ุฅุนูุงูุงุช ุนุงุฏูุฉ ูุฌุงููุฉุ ูููุฒุฉ ูุฏููุนุฉ
```sql
UPDATE category_plan_prices 
SET standard_ad_price = 0,
    featured_ad_price = 100
WHERE category_id = (SELECT id FROM categories WHERE slug = 'real-estate');
```

**ุงููุชูุฌุฉ:** 
- ุงูุฅุนูุงูุงุช ุงูุนุงุฏูุฉ ูุฌุงููุฉ
- ุงูุฅุนูุงูุงุช ุงููููุฒุฉ ุชุญุชุงุฌ ุจุงูุฉ ุฃู ุฏูุน

### ูุซุงู 3: ุนุฑุถ ุชุฑููุฌู ูุคูุช
```sql
-- ุฌุนู ุงูุฅุนูุงูุงุช ุงููููุฒุฉ ูุฌุงููุฉ ููุชุฑุฉ ูุญุฏูุฏุฉ
UPDATE category_plan_prices 
SET featured_ad_price = 0
WHERE category_id IN (1, 2, 3);

-- ุจุนุฏ ุงูุชูุงุก ุงูุนุฑุถ
UPDATE category_plan_prices 
SET featured_ad_price = 100
WHERE category_id IN (1, 2, 3);
```

---

## ๐ ููุงุท ูููุฉ

### โ ุงููุฒุงูุง:
1. **ูุฑููุฉ ุฃูุจุฑ:** ูููู ุฌุนู ุฃู ูุณู ูุฌุงูู ุจุณูููุฉ
2. **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุฃูุถู:** ูุง ุญุงุฌุฉ ูุจุงูุงุช ูู ุงูุฃูุณุงู ุงููุฌุงููุฉ
3. **ุณูููุฉ ุงูุฅุฏุงุฑุฉ:** ุชุบููุฑ ุงูุณุนุฑ ุฅูู 0 ูููู
4. **ุนุฑูุถ ุชุฑููุฌูุฉ:** ูููู ุนูู ุนุฑูุถ ูุคูุชุฉ ุจุณูููุฉ

### โ๏ธ ููุงุญุธุงุช:
1. **ูุง ูุชู ุฎุตู ูู ุงูุฑุตูุฏ:** ุนูุฏูุง ุงูุณุนุฑ = 0ุ ูุง ูุชู ุงุณุชููุงู ุงูุจุงูุฉ
2. **ุงูุฃููููุฉ ููุณุนุฑ:** ูุญุต ุงูุณุนุฑ ูุฃุชู ูุจู ูุญุต ุงูุฑุตูุฏ
3. **publish_via:** ูุชู ุชุณุฌูู `free_plan` ูุชูููุฒ ูุฐู ุงูุฅุนูุงูุงุช
4. **ูุฏุฉ ุงูุตูุงุญูุฉ:** ุชูุญุฏุฏ ุญุณุจ ุงูุฃูุงู ุงููุญุฏุฏุฉ ูู ุงููุณู

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

### ูุจู ุงููุดุฑ ุนูู Production:
- [ ] ุชุดุบูู ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุงูุชุฃูุฏ ูู ูุฌุงุญูุง
- [ ] ุงุฎุชุจุงุฑ ูุฏูู ุนูู staging environment
- [ ] ูุฑุงุฌุนุฉ ุงูููุฏ ูุน ุงููุฑูู
- [ ] ุชุญุฏูุซ ุงูู API documentation
- [ ] ุฅุจูุงุบ ูุฑูู ุงูุฏุนู ุจุงูุชุบููุฑุงุช

### ุจุนุฏ ุงููุดุฑ:
- [ ] ูุฑุงูุจุฉ ุงูู logs ููุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก
- [ ] ูุชุงุจุนุฉ ุฅุญุตุงุฆูุงุช ุงูุฅุนูุงูุงุช ุงููุฌุงููุฉ
- [ ] ุฌูุน feedback ูู ุงููุณุชุฎุฏููู

---

## ๐ ุงูุฏุนู

ูู ุญุงูุฉ ูุฌูุฏ ุฃู ูุดุงูู ุฃู ุงุณุชูุณุงุฑุงุช:
1. ุฑุงุฌุน ููู `QUICK_TEST_GUIDE.md` ูุงุณุชูุดุงู ุงูุฃุฎุทุงุก
2. ุฑุงุฌุน ููู `FREE_PLAN_TESTS_README.md` ูุชูุงุตูู ุงูุงุฎุชุจุงุฑุงุช
3. ุชุญูู ูู ุงูู logs: `storage/logs/laravel.log`

---

## ๐ ุงูุณุฌู

| ุงูุชุงุฑูุฎ | ุงูุฅุตุฏุงุฑ | ุงูุชุบููุฑ |
|---------|---------|---------|
| 2026-02-23 | 1.0.0 | ุงูุฅุตุฏุงุฑ ุงูุฃูู - ุฅุถุงูุฉ ููุทู ุงูุณุนุฑ = 0 |

---

**ุชู ุงูุชูููุฐ ุจูุงุณุทุฉ:** Kiro AI Assistant  
**ุงูุชุงุฑูุฎ:** 23 ูุจุฑุงูุฑ 2026  
**ุงูุญุงูุฉ:** โ ุฌุงูุฒ ููุงุฎุชุจุงุฑ
